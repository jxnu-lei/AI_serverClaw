import{B as e,C as t,D as n,E as r,F as i,I as a,K as o,N as s,O as c,R as l,S as u,T as d,V as f,W as p,i as m,j as h,k as g,r as _,w as v,z as y}from"./index-md6nwtnd.js";import{t as b}from"./_plugin-vue_export-helper-CSBScHBl.js";import{t as x}from"./api-BFhxd5g9.js";var S={class:`user-management-container`},C={class:`page-header`},w=b(g({__name:`UserManagementView`,setup(o){let g=f([]),b=f(!1),w=f(!1),T=f(!1),E=f(),D=e({id:``,username:``,email:``,role:`user`,is_active:!0}),O=e({username:``,email:``,password:``,role:`user`}),k={username:[{required:!0,message:`请输入用户名`,trigger:`blur`},{min:3,max:20,message:`用户名长度3-20个字符`,trigger:`blur`}],email:[{required:!0,message:`请输入邮箱`,trigger:`blur`},{type:`email`,message:`请输入正确的邮箱格式`,trigger:`blur`}],password:[{required:!0,message:`请输入密码`,trigger:`blur`},{min:6,message:`密码至少6位`,trigger:`blur`}]},A=u(()=>localStorage.getItem(`user_role`)===`admin`),j=async()=>{b.value=!0;try{let e=await x.get(`/api/admin/users`);g.value=e.data||e||[]}catch(e){console.error(`加载用户列表失败:`,e),m.error(`加载用户列表失败`)}finally{b.value=!1}},M=e=>{D.id=e.id,D.username=e.username,D.email=e.email,D.role=e.role,D.is_active=e.is_active,w.value=!0},N=async()=>{try{await x.put(`/api/admin/users/${D.id}`,{email:D.email,role:D.role,is_active:D.is_active}),m.success(`用户更新成功`),w.value=!1,j()}catch(e){console.error(`更新用户失败:`,e),m.error(`更新用户失败`)}},P=async e=>{try{await x.put(`/api/admin/users/${e.id}`,{is_active:!e.is_active}),m.success(e.is_active?`用户已禁用`:`用户已启用`),j()}catch(e){console.error(`更新用户状态失败:`,e),m.error(`更新用户状态失败`)}},F=async e=>{try{await _.confirm(`确定要删除用户 "${e.username}" 吗？`,`确认删除`,{confirmButtonText:`删除`,cancelButtonText:`取消`,type:`warning`}),await x.delete(`/api/admin/users/${e.id}`),m.success(`用户删除成功`),j()}catch(e){e!==`cancel`&&(console.error(`删除用户失败:`,e),m.error(e?.response?.data?.detail||`删除用户失败`))}},I=async e=>{try{await _.confirm(`确定要重置用户 "${e.username}" 的密码吗？`,`确认重置密码`,{confirmButtonText:`重置`,cancelButtonText:`取消`,type:`warning`}),await x.post(`/api/admin/users/${e.id}/reset-password`),m.success(`密码已重置为 admin!123`)}catch(e){e!==`cancel`&&(console.error(`重置密码失败:`,e),m.error(e?.response?.data?.detail||`重置密码失败`))}},L=()=>{O.username=``,O.email=``,O.password=``,O.role=`user`,T.value=!0},R=async()=>{if(E.value)try{await E.value.validate(),await x.post(`/api/admin/users`,{username:O.username,email:O.email,password:O.password,role:O.role}),m.success(`用户创建成功`),T.value=!1,j()}catch(e){console.error(`创建用户失败:`,e);let t=e?.response?.data?.detail||e?.message||`创建用户失败`;m.error(t)}},z=e=>e?new Date(e).toLocaleString(`zh-CN`):`-`;return h(()=>{if(!A.value){m.warning(`只有管理员可以访问用户管理`);return}j()}),(e,o)=>{let u=i(`el-button`),f=i(`el-table-column`),m=i(`el-tag`),h=i(`el-table`),_=i(`el-card`),x=i(`el-input`),j=i(`el-form-item`),B=i(`el-option`),V=i(`el-select`),H=i(`el-switch`),U=i(`el-form`),W=i(`el-dialog`),G=a(`loading`);return s(),r(`div`,S,[t(`div`,C,[o[11]||=t(`h1`,null,`用户管理`,-1),c(u,{type:`primary`,onClick:L},{default:l(()=>[...o[10]||=[n(`新增用户`,-1)]]),_:1})]),c(_,null,{default:l(()=>[y((s(),v(h,{data:g.value,style:{width:`100%`}},{default:l(()=>[c(f,{prop:`username`,label:`用户名`,width:`150`}),c(f,{prop:`email`,label:`邮箱`,"min-width":`200`}),c(f,{prop:`role`,label:`角色`,width:`100`},{default:l(({row:e})=>[c(m,{type:e.role===`admin`?`danger`:`info`,size:`small`},{default:l(()=>[n(p(e.role===`admin`?`管理员`:`普通用户`),1)]),_:2},1032,[`type`])]),_:1}),c(f,{prop:`is_active`,label:`状态`,width:`80`},{default:l(({row:e})=>[c(m,{type:e.is_active?`success`:`danger`,size:`small`},{default:l(()=>[n(p(e.is_active?`活跃`:`禁用`),1)]),_:2},1032,[`type`])]),_:1}),c(f,{prop:`created_at`,label:`创建时间`,width:`180`},{default:l(({row:e})=>[n(p(z(e.created_at)),1)]),_:1}),c(f,{label:`操作`,width:`320`,fixed:`right`},{default:l(({row:e})=>[c(u,{size:`small`,onClick:t=>M(e)},{default:l(()=>[...o[12]||=[n(`编辑`,-1)]]),_:1},8,[`onClick`]),c(u,{size:`small`,type:e.is_active?`danger`:`success`,disabled:e.username===`admin`,onClick:t=>P(e)},{default:l(()=>[n(p(e.is_active?`禁用`:`启用`),1)]),_:2},1032,[`type`,`disabled`,`onClick`]),c(u,{size:`small`,type:`warning`,onClick:t=>I(e)},{default:l(()=>[...o[13]||=[n(` 重置密码 `,-1)]]),_:1},8,[`onClick`]),e.username===`admin`?d(``,!0):(s(),v(u,{key:0,size:`small`,type:`danger`,onClick:t=>F(e)},{default:l(()=>[...o[14]||=[n(` 删除 `,-1)]]),_:1},8,[`onClick`]))]),_:1})]),_:1},8,[`data`])),[[G,b.value]])]),_:1}),c(W,{title:`编辑用户`,visible:w.value,width:`500px`},{footer:l(()=>[c(u,{onClick:o[4]||=e=>w.value=!1},{default:l(()=>[...o[15]||=[n(`取消`,-1)]]),_:1}),c(u,{type:`primary`,onClick:N},{default:l(()=>[...o[16]||=[n(`保存`,-1)]]),_:1})]),default:l(()=>[c(U,{model:D,"label-width":`80px`},{default:l(()=>[c(j,{label:`用户名`},{default:l(()=>[c(x,{modelValue:D.username,"onUpdate:modelValue":o[0]||=e=>D.username=e,disabled:``},null,8,[`modelValue`])]),_:1}),c(j,{label:`邮箱`},{default:l(()=>[c(x,{modelValue:D.email,"onUpdate:modelValue":o[1]||=e=>D.email=e},null,8,[`modelValue`])]),_:1}),c(j,{label:`角色`},{default:l(()=>[c(V,{modelValue:D.role,"onUpdate:modelValue":o[2]||=e=>D.role=e,disabled:!A.value},{default:l(()=>[c(B,{label:`普通用户`,value:`user`}),c(B,{label:`管理员`,value:`admin`})]),_:1},8,[`modelValue`,`disabled`])]),_:1}),c(j,{label:`状态`},{default:l(()=>[c(H,{modelValue:D.is_active,"onUpdate:modelValue":o[3]||=e=>D.is_active=e,"active-text":`启用`,"inactive-text":`禁用`},null,8,[`modelValue`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`visible`]),c(W,{title:`新增用户`,visible:T.value,width:`500px`},{footer:l(()=>[c(u,{onClick:o[9]||=e=>T.value=!1},{default:l(()=>[...o[17]||=[n(`取消`,-1)]]),_:1}),c(u,{type:`primary`,onClick:R},{default:l(()=>[...o[18]||=[n(`创建`,-1)]]),_:1})]),default:l(()=>[c(U,{model:O,rules:k,ref_key:`createFormRef`,ref:E,"label-width":`80px`},{default:l(()=>[c(j,{label:`用户名`,prop:`username`},{default:l(()=>[c(x,{modelValue:O.username,"onUpdate:modelValue":o[5]||=e=>O.username=e,placeholder:`请输入用户名`},null,8,[`modelValue`])]),_:1}),c(j,{label:`邮箱`,prop:`email`},{default:l(()=>[c(x,{modelValue:O.email,"onUpdate:modelValue":o[6]||=e=>O.email=e,placeholder:`请输入邮箱`},null,8,[`modelValue`])]),_:1}),c(j,{label:`密码`,prop:`password`},{default:l(()=>[c(x,{modelValue:O.password,"onUpdate:modelValue":o[7]||=e=>O.password=e,type:`password`,placeholder:`请输入密码`,"show-password":``},null,8,[`modelValue`])]),_:1}),c(j,{label:`角色`},{default:l(()=>[c(V,{modelValue:O.role,"onUpdate:modelValue":o[8]||=e=>O.role=e},{default:l(()=>[c(B,{label:`普通用户`,value:`user`}),c(B,{label:`管理员`,value:`admin`})]),_:1},8,[`modelValue`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`visible`])])}}}),[[`__scopeId`,`data-v-96508971`]]);export{w as default};